var DriverInfo = {
    'IDs': [],
    'Devicelist': []
};
var IDs = new Array('USB\\Vid_054c&Pid_0268', 'USB\\Vid_054c&Pid_03b4', 'USB\\Vid_054c&Pid_03d5', 'USB\\Vid_054c&Pid_03a0', 'USB\\VID_054c&PID_042f', 'USB\\Vid_1C13&Pid_6708', 'USB\\Vid_11ff&Pid_3341', 'USB\\Vid_8380&Pid_2188', 'USB\\Vid_8380&Pid_2165', 'USB\\Vid_146b&Pid_0302', 'USB\\Vid_12bd&Pid_c003', 'USB\\Vid_0e8f&Pid_0003', 'USB\\Vid_0079&Pid_0006');
var gpadinf = {
    'inf': [
    {
        'VID': 0x1c13,
        'PID': 0x6708,
        'data': [0x07, 0x08, 0x81, 0x02, 0x03, 0x04, 0x05, 0x06, 0x00, 0x00, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x10, 0x11, 0x12, 0x13, 0x14, 0x00, 0x00, 0x00, 0x02, 0xf0, 0x10, 0x20, 0x30, 0x40, 0x50, 0x60, 0x70, 0x80, 0x02, 0x04, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x51, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x50, 0x50, 0xff, 0xff, 0x00, 0x00]}, {
        'VID': 0x0079,
        'PID': 0x0006,
        'data': [0x08, 0x07, 0x81, 0x01, 0x00, 0x01, 0x04, 0x03, 0x00, 0x00, 0x54, 0x55, 0x56, 0x57, 0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0xff, 0x00, 0x00, 0x00, 0x05, 0x0f, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x02, 0x04, 0x03, 0xfa, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x51, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xf3, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]}, {
        'VID': 0x12bd,
        'PID': 0xc003,
        'data': [0x07, 0x03, 0x81, 0x00, 0x00, 0x01, 0x02, 0x03, 0x00, 0x00, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0x60, 0x61, 0x62, 0x63, 0xff, 0x00, 0x00, 0x00, 0x04, 0x0f, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x00, 0x01, 0x30, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]}, {
        'VID': 0x0e8f,
        'PID': 0x0003,
        'data': [0x08, 0x04, 0x81, 0x00, 0x02, 0x03, 0x00, 0x01, 0x00, 0x00, 0x54, 0x55, 0x56, 0x57, 0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0xff, 0x00, 0x00, 0x00, 0x05, 0x0f, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x02, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]}, {
        'VID': 0x146b,
        'PID': 0x0302,
        'data': [0x07, 0x04, 0x81, 0x02, 0x00, 0x01, 0x02, 0x03, 0x00, 0x00, 0x43, 0x41, 0x40, 0x42, 0x44, 0x45, 0x46, 0x47, 0x50, 0x51, 0x52, 0x53, 0x54, 0x00, 0x00, 0x00, 0x06, 0x0f, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x01, 0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]}, {
        'VID': 0x8380,
        'PID': 0x2165,
        'data': [0x07, 0x03, 0x81, 0x02, 0x00, 0x01, 0x03, 0x02, 0x00, 0x00, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0x60, 0x61, 0x62, 0x63, 0xff, 0x00, 0x00, 0x00, 0x04, 0x0f, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]}, {
        'VID': 0x8380,
        'PID': 0x2188,
        'data': [0x08, 0x03, 0x81, 0x02, 0x00, 0x01, 0x03, 0x02, 0x00, 0x00, 0x47, 0x45, 0x44, 0x46, 0x50, 0x51, 0x52, 0x53, 0x54, 0x55, 0x56, 0x57, 0xff, 0x00, 0x00, 0x00, 0x04, 0x0f, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]}, {
        'VID': 0x11ff,
        'PID': 0x3341,
        'data': [0x08, 0x05, 0x81, 0x00, 0x03, 0x04, 0x01, 0x02, 0x00, 0x00, 0x54, 0x55, 0x56, 0x57, 0x60, 0x61, 0x62, 0x63, 0x64, 0x65, 0x66, 0x67, 0xff, 0x00, 0x00, 0x00, 0x05, 0x0f, 0x00, 0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x02, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00]}]
};
$(function ()
{
    SetBusy(false);
    if (VersionTool >= VER)
    {
        try
        {
            DriverInfo['IDs'] = IDs;
            window.external.MIJconfig(1, 1, $.toJSON(DriverInfo));
            DriverInfo = eval('(' + window.external.MIJconfig(0, 1, "") + ')')
        }
        catch (err)
        {
            DisplayMessage(err.description)
        }
        listDevice(DriverInfo['Devicelist']);
        $('#LoadDriver').click(function ()
        {
            if ($("input[type='checkbox']:checked").length != 0)
            {
                $('#installlog').html('<h1 style="width:100%; color: #9F6000;background-color: #FEEFB3;font-size:20px;">This may take a few seconds.Please wait a moment!</h1>');
                $("input[type='checkbox']:checked").each(function ()
                {
                    for (var index in gpadinf.inf)
                    {
                        if (gpadinf.inf[index].VID == parseInt(DriverInfo['Devicelist'][$(this).data('index')].HardwareID.substr(8, 4), 16))
                        {
                            if (gpadinf.inf[index].PID == parseInt(DriverInfo['Devicelist'][$(this).data('index')].HardwareID.substr(17, 4), 16))
                            {
                                setgpadinf($.toJSON(gpadinf.inf[index]))
                            }
                        }
                    }
                    PlaceDriver($(this).val(), 0)
                })
            }
            else
            {
                alert('You must select at least one device !')
            }
        });
        $('#Rollback').click(function ()
        {
            if ($("input[type='checkbox']:checked").length != 0)
            {
                $('#installlog').html('<h1 style="width:100%; color: #9F6000;background-color: #FEEFB3;font-size:20px;">This may take a few seconds.Please wait a moment!</h1>');
                $("input[type='checkbox']:checked").each(function ()
                {
                    PlaceDriver($(this).val(), 1)
                })
            }
            else
            {
                alert('You must select at least one device !')
            }
        });
        $('#RemoveDriver').click(function ()
        {
            PlaceDriver(0, 3)
        });
        $('#GPProperty').click(function ()
        {
            cPannel()
        });
        $('#DeviceManager').click(function ()
        {
            window.external.ConfigMotioninJoy(0, 2, 1, '')
        });
        $('#InstllDriver').click(function ()
        {
            $('#installlog').html('<h1 style="width:100%; color: #9F6000;background-color: #FEEFB3;font-size:20px;">This may take a few seconds.Please wait a moment!</h1>');
            PlaceDriver(0, 2)
        })
    }
});

function DeviceChange()
{
    DriverInfo = eval('(' + window.external.MIJconfig(0, 1, "") + ')');
    listDevice(DriverInfo['Devicelist'])
}
function listDevice(dl)
{
    $('#InstallTable > tbody').html('');
    for (var i in dl)
    {
        var html = '<tr><td><input type="checkbox" value="' + dl[i].index + '" data-index="' + i + '"/></td>';
        html += '<td>' + dl[i].LocationInformation + '</td>';
        html += '<td>' + dl[i].HardwareID + '</td>';
        html += '<td align="center"><img src="misc/images/';
        if (dl[i].LowerFilter == 'MotioninJoyXFilter')
        {
            html += 'q_correct.png'
        }
        else
        {
            html += 'q_incorrect.png'
        }
        html += '"width="12" height="12"></td></tr>';
        $('#InstallTable > tbody:last').append(html)
    }
}
function Drvierlog(EventDescription, EventType, ErrorCode)
{
    var message = '';
    switch (EventType)
    {
    case 0:
        if (ErrorCode == 0)
        {
            message = '<p style="color: #4F8A10;background-color: #DFF2BF;">' + 'SUCCESS:' + EventDescription + '</p>'
        }
        else
        {
            message = '<p style="color: #4F8A10;background-color: #DFF2BF;">' + 'SUCCESS:' + EventDescription + '. Error code:0X' + ErrorCode.toString(16) + '</p>'
        }
        break;
    case 1:
        if (ErrorCode == 0)
        {
            message = '<p style="color: #00529B;background-color: #BDE5F8">' + 'INFO:' + EventDescription + '</p>'
        }
        else
        {
            message = '<p style="color: #00529B;background-color: #BDE5F8">' + 'INFO:' + EventDescription + '. Error code:0X' + ErrorCode.toString(16) + '</p>'
        }
        break;
    case 2:
        if (ErrorCode == 0)
        {
            message = '<p style="color: #9F6000;background-color: #FEEFB3;">' + 'WARNING:' + EventDescription + '</p>'
        }
        else
        {
            message = '<p style="color: #9F6000;background-color: #FEEFB3;">' + 'WARNING:' + EventDescription + '. Error code:0X' + ErrorCode.toString(16) + '</p>'
        }
        break;
    case 3:
        if (ErrorCode == 0)
        {
            message = '<p style="color: #D8000C;background-color: #FFBABA;">' + 'ERROR:' + EventDescription + '</p>'
        }
        else
        {
            message = '<p style="color: #D8000C;background-color: #FFBABA;">' + 'ERROR:' + EventDescription + '. Error code:0X' + ErrorCode.toString(16) + '</p>'
        }
        break;
    default:
        break
    }
    $(message).appendTo('#installlog')
}
