var defaultRemoteMaping = new Array(0x01, 0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0x00, 0xff, 0x0b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x16, 0xff, 0xff, 0xff, 0xff, 0xff, 0x19, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x0d, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x1e, 0x21, 0x1f, 0x20, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x5e, 0x5b, 0x5c, 0x5d, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff);
var RemoteButtonValue = new Array(0x16, 0x00, 0x01, 0x02, 0x64, 0x03, 0x04, 0x05, 0x65, 0x06, 0x07, 0x08, 0x63, 0x0F, 0x09, 0x28, 0x81, 0x82, 0x83, 0x80, 0x70, 0x1A, 0x40, 0x0E, 0x5C, 0x5D, 0x5E, 0x5F, 0x54, 0x55, 0x56, 0x57, 0x0B, 0x5A, 0x58, 0x51, 0x5B, 0x59, 0x52, 0x43, 0x50, 0x53, 0x33, 0x32, 0x34, 0x30, 0x38, 0x31, 0x60, 0x39, 0x61);
var remotermap;
var Inquery = false;
var Timeout = 100;
var InqueryTimer;
var BDAddr;
var BDName;
var BDCount = 'fail';
var BTindex = 0;
$(function ()
{
    SetBusy(false);
    if (VersionTool > 0)
    {
        $.mask.definitions['h'] = '[a-f0-9A-F]';
        $(".mcevalue").mask("hh", {
            placeholder: " "
        });
        try
        {
            remotermap = GetBDRMmap();
            for (var i in remotermap['map'])
            {
                $('#mcevalue_' + i).val(ConverteValue(parseInt(remotermap['map'][i])))
            }
        }
        catch (err)
        {
            DisplayMessage(err.description)
        }
        $("#RemoteEnable").click(function ()
        {
            mmm(Mxxx, Myyy, Mvvvv);
            for (var i in RemoteButtonValue)
            {
                var value = '0x' + $("#mcevalue_" + i).val();
                remotermap['map'][i] = parseInt(value)
            }
            SetBDRMmap(remotermap)
        });
        $("#RemoteDefault").click(function ()
        {
            mmm(Mxxx, Myyy, Mvvvv);
            DefaultValue()
        });
        $("#BDInquery").click(function ()
        {
            mmm(Mxxx, Myyy, Mvvvv);
            try
            {
                clearTimeout(InqueryTimer);
                BDCount = 'fail';
                Timeout = 100;
                BDAddr = new Array('fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail');
                BDName = new Array('fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail', 'fail');
                BDInquery(BTindex);
                $('#BDDevice').html("");
                $('#InqueryInfo').html("");
                $("#BDInquiryDlog").dialog(
                {
                    show: 'blind',
                    hide: 'blind',
                    title: "Inquery Bluetooth Device",
                    modal: true,
                    autoOpen: true,
                    draggable: true,
                    height: 240,
                    width: 680
                });
                InqueryCheck()
            }
            catch (err)
            {
                DisplayMessage(err.description)
            }
        })
    }
});

function DefaultValue()
{
    for (var i in RemoteButtonValue)
    {
        $("#mcevalue_" + i).val(ConverteValue(defaultRemoteMaping[RemoteButtonValue[i]]))
    }
}
function ConverteValue(value)
{
    var result = "FF";
    if (value < 0x10)
    {
        result = '0' + value.toString(16)
    }
    else
    {
        result = value.toString(16)
    }
    return result
}
function InqueryCheck()
{
    BDCount = BDInqueryCount(BTindex);
    if (BDCount == 0xff)
    {
        setTimeout('InqueryCheck()', 1000)
    }
    else if (BDCount == 0x00)
    {
        $('<p>Timeout!!!</p>').appendTo('#InqueryInfo')
    }
    else
    {
        for (var i = 0; i < BDCount; i++)
        {
            var qdinf = eval('(' + BDRemoteAddr(BTindex, i) + ')');
            if (qdinf.state < 3)
            {
                setTimeout('InqueryCheck()', 1000);
                return
            }
            else
            {
                var BDadd = qdinf.BDAddr[0].toString(16) + '.' + qdinf.BDAddr[1].toString(16) + '.' + qdinf.BDAddr[2].toString(16) + '.' + qdinf.BDAddr[3].toString(16) + '.' + qdinf.BDAddr[4].toString(16) + '.' + qdinf.BDAddr[5].toString(16);
                $('<p  ><a title="' + BDadd + '" class="ConnectBD" style="font-size:24px;cursor: hand;">' + BDadd + '----' + qdinf.Name.join('') + '</a></p>').appendTo('#BDDevice');
                $('a.ConnectBD').click(function ()
                {
                    ConnectRemoteBD(BTindex, this.title);
                    return false
                })
            }
        }
    }
}
